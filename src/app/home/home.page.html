<ion-header class="ion-no-border">
  <ion-toolbar class="custom-toolbar">
    <div slot="start" class="profile-container">
      <div class="avatar-wrapper">
        <div class="avatar">
          <img src="assets/ninja-avatar.jpg" alt="Profile" onerror="this.src='https://ionicframework.com/docs/img/demos/avatar.svg'"/>
        </div>
        <div class="status-indicator online"></div>
      </div>
      <div class="user-info">
        <span class="username">Kakashi Hatake</span>
        <span class="user-rank">Jōnin - Elite</span>
      </div>
    </div>

    <div slot="end" class="board-label">
      <ion-icon name="list-outline"></ion-icon> TABLÓN
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="dark-content">
  
  <div class="search-section">
    <div class="search-container">
      <ion-searchbar placeholder="Rastrear objetivo..." class="custom-search" showCancelButton="focus"></ion-searchbar>
    </div>
    <button class="btn-filter">
      <ion-icon name="options-outline"></ion-icon>
    </button>
  </div>

  <div class="segment-container">
    <ion-segment [(ngModel)]="segmentValue" mode="md" class="custom-segment">
      <ion-segment-button value="available">
        <ion-label>Disponibles</ion-label>
      </ion-segment-button>
      <ion-segment-button value="in-progress">
        <ion-label>En Curso</ion-label>
      </ion-segment-button>
      <ion-segment-button value="completed">
        <ion-label>Historial</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <div class="missions-grid">
    
    <div *ngFor="let mission of filteredMissions" 
         class="mission-card"
         [class.card-active]="segmentValue === 'in-progress'"
         [style.border-left-color]="rankColors[mission.rank]">
      
      <div class="card-decoration top-right"></div>

      <div class="card-header">
        <div class="rank-badge-container">
          <span class="rank-badge" [style.background-color]="rankColors[mission.rank]">
            {{mission.rank}}
          </span>
          <div class="danger-level" *ngIf="mission.dangerLevel">
            <ng-container *ngFor="let i of [1,2,3,4,5]; let idx = index">
               <ion-icon name="skull" *ngIf="idx < mission.dangerLevel" [style.color]="rankColors[mission.rank]"></ion-icon>
            </ng-container>
          </div>
        </div>
        
        <div class="reward-tag">
          <ion-icon name="cash-outline"></ion-icon>
          <span>{{ mission.reward | number }} Ryō</span>
        </div>
      </div>

      <div class="card-body">
        <h3 class="mission-title">{{ mission.title }}</h3>
        
        <div class="mission-meta">
          <div class="meta-item">
            <ion-icon name="location-outline"></ion-icon>
            <span>{{ mission.sector || 'Desconocido' }}</span>
          </div>
          <div class="meta-item" *ngIf="segmentValue === 'available'">
            <ion-icon name="hourglass-outline"></ion-icon>
            <span>Expira: {{ mission.expirationTime || '24h' }}</span>
          </div>
        </div>
      </div>

      <div class="card-footer">
        
        <ng-container *ngIf="segmentValue === 'available'">
          <button class="btn-action glitch-effect" (click)="openAcceptModal(mission)" 
                  [style.background-color]="rankColors[mission.rank]">
            <span class="btn-text">ACEPTAR CONTRATO</span>
            <ion-icon name="finger-print-outline"></ion-icon>
          </button>
        </ng-container>

        <ng-container *ngIf="segmentValue !== 'available'">
          <div class="assignee-row" *ngIf="mission.assignee">
            <div class="assignee-info">
              <div class="avatar-border">
                <img [src]="mission.assignee.photoUrl" class="mini-avatar">
              </div>
              <div class="assignee-details">
                <span class="label">Operativo:</span>
                <span class="name">{{ mission.assignee.name }}</span>
              </div>
            </div>
          </div>
          
          <button class="btn-outline full-width" (click)="goToDetails(mission.id)">
            <span *ngIf="segmentValue === 'in-progress'">ACCEDER A DATOS</span>
            <span *ngIf="segmentValue === 'completed'">VER REPORTE</span>
          </button>
        </ng-container>

      </div>
    </div>

    <div class="empty-state" *ngIf="filteredMissions.length === 0">
      <ion-icon name="file-tray-outline"></ion-icon>
      <p>Sin registros en esta categoría.</p>
    </div>

  </div>
</ion-content>